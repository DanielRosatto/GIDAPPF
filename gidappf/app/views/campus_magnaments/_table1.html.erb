<!-- ########################################################################## -->
<!-- # Universidad Nacional Arturo Jauretche                                  # -->
<!-- # Instituto de Ingeniería y Agronomía -Ingeniería en Informática         # -->
<!-- # Práctica Profesional Supervisada Nro 12 - Segundo cuatrimestre de 2018 # -->
<!-- #    <<Gestión Integral de Alumnos Para el Proyecto Fines>>              # -->
<!-- # Tutores:                                                               # -->
<!-- #    - UNAJ: Dr. Ing. Morales, Martín                                    # -->
<!-- #    - ORGANIZACIÓN: Ing. Cortes Bracho, Oscar                           # -->
<!-- #    - ORGANIZACIÓN: Mg. Ing. Diego Encinas                              # -->
<!-- # Autor: Ap. Daniel Rosatto <danielrosatto@gmail.com>                    # -->
<!-- # Archivo GIDAPPF/gidappf/app/views/campus_magnaments/_table1.html.erb   # -->
<!-- ########################################################################## -->
<h3><%= title %></h3>
<table>
  <thead>
     <tr>
      <th><%= params[:profile_type].first(params[:profile_type].index("@")).capitalize + ":" %></th>
      <th colspan=".<%= comms_period.count.to_s %>." >Commission:</th>
     </tr>
  </thead>

  <tbody remote="true">
    <% profiles_period.each do |p| %>
      <tr>
        <td><%= link_to "#{p.name}", profile_path(id: p.id) %></td>
        <td>
          <% p.documents.first.user.usercommissionroles.each do |ucr| %>
            <div class="field">
              <p><%= "#{p.documents.first.user.usercommissionroles.index(ucr)+1}. #{ucr.role.name} at commission: #{ucr.commission.name}" %></p>
            </div>
            <div class="field">
              <% if params[:profile_type].eql?(LockEmail::LIST[1]) then  %>
                <% comms_period.each do |ts| %>
                  <!-- redirecciona a la accion selected_commission con los parametros id y box_selected con valores dados por check_box_tag -->
                  <%= check_box_tag(nil,ucr.commission_id,ts.commission.id == ucr.commission_id,
                      onclick: "$(document).ready(function() {
                          window.location.href='"+
                            campus_magnaments_set_campus_segmentation_path(
                              id: p.id,box_selected: ts.id.to_s,
                              def_period: params[:def_period],
                              profile_type: params[:profile_type],
                              ucr_id: ucr.id)+
                          "'});",
                      :disabled  => ts.selectable?) %>
                  <%= label_tag(ts.commission_info) %>
                <% end %>
              <% elsif params[:profile_type].eql?(LockEmail::LIST[2]) then  %>
                <% comms_period.each do |ts| %>
                  <% if ts.matter_id.eql?(p.profile_keys.find_by(key:"Materias:").profile_values.first.value.to_i) then %>
                    <%= check_box_tag(nil,ucr.commission_id,ts.time_sheet.commission.id == ucr.commission_id,
                        onclick: "$(document).ready(function() {
                            window.location.href='"+
                              campus_magnaments_set_campus_segmentation_path(
                                id: p.id,box_selected: ts.time_sheet.id.to_s,
                                def_period: params[:def_period],
                                profile_type: params[:profile_type],
                                ucr_id: ucr.id,
                                tsh_id: ts.id)+
                            "'});",
                        :disabled  => ts.time_sheet.selectable?) %>
                    <%= label_tag(nil,"#{ts.occupied_hour_fmt}#{ts.matter.name} #{ts.time_sheet.commission_info}", class: 'gidappf-small_label') %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
